<!DOCTYPE html>
{% load staticfiles %} <!-- New line -->

<html lang="en">
<head>
    <title>Rulers of The Kingdom</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <script>
        //polling that gets the logs
        populateLogBox();
        setInterval(populateLogBox(), 5000);

        function populateLogBox(){
            $.get('/game/get_logs/', function(data){
                console.log(data);
                $('#logs_text').html(data.replace(/\$\$/g,'<br />'));
            });
        }
	    $('#buy').click(function(){
        	var catid;
    		tt = $(this).attr("troop_type");
    		$.get('/game/buy', {troop_type: tt}, function(data){
               //increments stuff
                $('#footmen').html(data);
   			 }, functionerror(data){
   			 		//error happened for not enough gold
   			 });
		});

    </script>

</head>
<body>

<img src="{% static "images/rulersofthekingdom.png" %}" width=50% class= col-md-offset-2 />

{% if user.is_authenticated %}
<div class="container">
    <div class="row">
        <div class="col-md-4">
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>Structures</th>
                    <th>Level</th>
                    <th>Upgrade Cost</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td style="width:5%">Supply</td>
                    <td style="width:5%">{{city.walls_level}}</td>
                    <td style="width:5%">{{cost.house_price}} <button id="buyhouse" type="button">+</button> </td>
                </tr>
                <tr>
                    <td style="width:5%">Walls Level</td>
                    <td style="width:5%">{{city.supply}}</td>
                    <td style="width:5%">{{cost.wall_price}} <button id="buywall" type="button">+</button> </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="col-md-4">
            <table class="table table-bordered">
                <thead>
                <tr>
                    <th>Troop Type</th>
                    <th>Amount</th>
                    <th>Hiring Cost</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td style="width:5%">Footmen</td>
                    <td style="width:5%">{{city.footmen}}</td>
                    <td style="width:5%"><span id="footmen">{{cost.footmen_price}}</span> <button id="buy" troop_type="footmen" type="button">+</button> </td>
                </tr>
                <tr>
                    <td style="width:5%">Knights</td>
                    <td style="width:5%">{{city.knights}}</td>
                    <td style="width:5%"><span id="knigts">{{cost.knights_price}}</span> <button id="buy" troop_type="knights" type="button">+</button> </td>
                </tr>
                <tr>
                    <td style="width:5%">Bowmen</td>
                    <td style="width:5%">{{city.bowmen}}</td>
                    <td style="width:5%"><span id="bowmen">{{cost.bowmen_price}}</span> <button id="buy" troop_type="bowmen" type="button">+</button> </td>
                </tr>
                <tr>
                    <td style="width:5%">WarMachines</td>
                    <td style="width:5%">{{city.war_machines}}</td>
                    <td style="width:5%"><span id="war_machines">{{cost.war_machines_price}}</span> <button id="buy" troop_type="war_machines" type="button">+</button> </td>
                </tr>
                </tbody>

            </table>
        </div>
        <div class="col-md-4">
            <div class="btn-group">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">Opponents <span
                        class="caret"></span></button>
                <ul class="dropdown-menu scrollable-menu" role="menu">
                    {% for acc in userlist %}
                    <li><a href="/game/battle/{{acc.user.username}}">{{acc.user.username}} </a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    {% if acc.alliance %}
    <div class="row">
        <strong>Alliance: </strong><a
            href="/game/alliance/{{acc.alliance.name}}">{{acc.alliance.name}}</a><br/>
    </div>
    {% endif %}

    <div class="row">
        <div class="panel panel-default col-md-4">
            <div class="panel-heading">Account Logs</div>
            <div id="logs_text" class="panel-body"></div>
        </div>
    </div>

    <div class="row">
        <a href="/game/logout/">Logout</a><br/>
    </div>
</div>

{% else %}
<a href="/game/register/">Register Here</a><br/>
<a href="/game/login/">Login</a><br/>
{% endif %}

</body>
</html>