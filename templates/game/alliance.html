<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <title>{{alliance.name}}</title>

    <script>
        function sendAllianceRequest() {
            var x = document.getElementById("msg").value;
            $.get('/game/alliance_request/{{ alliance.name}}', {msg: x}, function(data){
                $('#requestResult').html(data);
                if(data != -1){
                    $("#leaveNotifAlert").show();
                }
            });
            document.getElementById("msg").value="";
        }

        function leaveAlliance() {
            $.get('/game/leave_alliance/', function(data){
                $('#requestResult').html(data);
                if(data != -1){
                    $("#leaveNotifAlert").show();
                }
            });
        }

        function returnToGame(){
            window.location.href = "/game/";
        }

		$(document).ready(function(){
            $('.acceptButton').click(function() {
                reqAcc = $(this).attr("reqAcc");
                $.get('/game/accept_alliance/'+reqAcc, function(data){
                    location.reload();
                });
            });
            $('.declineButton').click(function() {
                reqAcc = $(this).attr("reqAcc");
                $.get('/game/decline_alliance/'+reqAcc, function(data){
                    location.reload();
                });
            });

            $('.alert .close').on('click', function(e) {
                returnToGame();
            });
        });
    </script>
</head>
<body>
<div class="container">
    <div class="row">
        <h1>Alliance {{ alliance.name}}</a></h1>
        <h2>Leader <a href="/game/battle/{{leader}}">{{leader}}</a></h2>
    </div>
    <div class="row">
        <strong>Alliance score:</strong> {{ alliance.all_time_score}}
        <strong>Description:</strong> {{ alliance.description}}
    </div>
    <div class="row">
        <strong>Message:</strong><input type="text" id="msg">
        <button onclick="sendAllianceRequest();" id="alliance_request_button" class="btn btn-primary" type="button">
            Request
        </button>
        {% if acc.alliance == alliance %}
        <button onclick="leaveAlliance();" id="leave_button" class="btn btn-primary" type="button">Leave</button>

        {% endif %}
    </div>
    <div class="alert fade in alert-success" id="leaveNotifAlert" style="display:none;">
        <button type="button" class="close">Ã—</button>
        <strong><span id="requestResult"></span></strong>
    </div>

    <div class="row">
        {% if acc.user.username == leader %}
        <h3>Alliance Requests ({{ requests | length }})</h3>
        <ol>
            {% for req in requests %}
            <li>{{req.from_account.user.username}} - {{req.date_occurred}}, Message: {{req.text}} , Wins:
                {{ req.from_account.wins }}
                <button reqAcc="{{req.from_account.user.username}}" type="button"
                        class="btn btn-success btn-xs acceptButton">Y
                </button>
                <button reqAcc="{{req.from_account.user.username}}" type="button"
                        class="btn btn-danger btn-xs declineButton">N
                </button>
            </li>
            {% endfor %}
        </ol>
        {% endif %}
    </div>

    <div class="row">
        <h3>Members ({{ allies | length }} / 50)</h3>
        <ol>
            {% for acc in allies %}
            <li><a href="/game/battle/{{acc.user.username}}">{{acc.user.username}}</a> {{ acc.wins }}</li>
            {% endfor %}
        </ol>
    </div>
</div>
</body>
</html>